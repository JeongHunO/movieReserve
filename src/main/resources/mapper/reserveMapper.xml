<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<!-- 
    [템플릿 설명]  
    - 해당 파일은 SQL 문을 작성하는 곳입니다.
-->
<mapper namespace="com.ezen.movie.mapper.reserve.ReserveMapper">

    <select id="selectMenu" resultType="reserveDTO" >
        select *
        from menu
    </select>
	
	
	<select id="getTimetable" parameterType="MoviesDTO" resultType="map">
		SELECT A.movie_idx 
			 , B.timetable_idx 
			 , A.movie_name_hngl 
			 , A.movie_rate 
			 , A.running_time 
			 , B.dimension_gb 
			 , B.start_time 
			 , B.finish_time 
			 , 60 - (SELECT COUNT(*) FROM SEAT_RESERVE C WHERE C.timetable_idx = B.timetable_idx) total
		  FROM MOVIES A INNER JOIN TIMETABLE B 
		    ON A.movie_idx = B.movie_idx 
		   AND B.screening_dt = #{wildCard}
		 WHERE 1=1
		   AND A.movie_idx = #{movieIdx} 
	</select>

</mapper>